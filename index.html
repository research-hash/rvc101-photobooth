<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RVC101 Esports Challenge 2025 — Photo Booth</title>
    <style>
        body {
            box-sizing: border-box;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-dark: #0b0f1a;
            --primary-purple: #7b3fe4;
            --neon-blue: #00d4ff;
            --neon-pink: #ff0080;
            --neon-green: #00ff88;
            --gold: #ffd700;
            --copper: #b87333;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, var(--primary-dark) 0%, #1a1a2e 50%, var(--primary-purple) 100%);
            color: white;
            min-height: 100%;
            overflow-x: hidden;
        }

        html {
            height: 100%;
        }

        /* Background effects */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at 20% 80%, rgba(123, 63, 228, 0.3) 0%, transparent 50%),
                        radial-gradient(circle at 80% 20%, rgba(0, 212, 255, 0.3) 0%, transparent 50%);
            z-index: -1;
            animation: backgroundPulse 4s ease-in-out infinite alternate;
        }

        @keyframes backgroundPulse {
            0% { opacity: 0.3; }
            100% { opacity: 0.6; }
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: bold;
            background: linear-gradient(45deg, var(--neon-blue), var(--primary-purple), var(--neon-pink));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
            text-shadow: 0 0 30px rgba(123, 63, 228, 0.5);
        }

        .header p {
            font-size: 1.1rem;
            color: #b0b0b0;
            margin-bottom: 20px;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 30px;
            margin-bottom: 40px;
        }

        .camera-section {
            position: relative;
        }

        .camera-container {
            position: relative;
            width: 100%;
            max-width: 640px;
            margin: 0 auto;
            border-radius: 20px;
            overflow: hidden;
            background: rgba(0, 0, 0, 0.8);
            box-shadow: 0 0 50px rgba(123, 63, 228, 0.3);
        }

        #video {
            width: 100%;
            height: auto;
            display: block;
        }

        .camera-placeholder {
            width: 100%;
            height: 480px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            background: linear-gradient(45deg, #1a1a2e, #16213e);
            color: #888;
            font-size: 1.1rem;
            text-align: center;
            padding: 20px;
        }

        /* Frame overlays */
        .frame-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .frame-overlay.active {
            opacity: 1;
        }

        /* Frame 1: RVC101 Main */
        .frame-rvc101-main {
            background: linear-gradient(45deg, transparent 20%, rgba(123, 63, 228, 0.1) 50%, transparent 80%);
            border: 8px solid var(--primary-purple);
            box-shadow: 
                inset 0 0 30px rgba(123, 63, 228, 0.3),
                0 0 50px rgba(123, 63, 228, 0.5);
            animation: circuitGlow 2s ease-in-out infinite alternate;
        }

        .frame-rvc101-main::before {
            content: 'RVC101 Esports Challenge 2025';
            position: absolute;
            top: 15px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(45deg, var(--neon-blue), var(--primary-purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-size: 1.2rem;
            font-weight: bold;
            text-shadow: 0 0 20px rgba(123, 63, 228, 0.8);
            white-space: nowrap;
        }

        @keyframes circuitGlow {
            0% { box-shadow: inset 0 0 30px rgba(123, 63, 228, 0.3), 0 0 50px rgba(123, 63, 228, 0.5); }
            100% { box-shadow: inset 0 0 50px rgba(123, 63, 228, 0.6), 0 0 80px rgba(123, 63, 228, 0.8); }
        }

        /* Frame 2: Esports Champion */
        .frame-esports-champ {
            background: linear-gradient(45deg, transparent 30%, rgba(255, 215, 0, 0.1) 50%, transparent 70%);
            border: 8px solid;
            border-image: linear-gradient(45deg, var(--gold), var(--copper), var(--gold)) 1;
            animation: championShimmer 1.5s ease-in-out infinite;
        }

        .frame-esports-champ::before {
            content: '👑 Champion Mode';
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            color: var(--gold);
            font-size: 1.4rem;
            font-weight: bold;
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.8);
        }

        @keyframes championShimmer {
            0%, 100% { filter: brightness(1) saturate(1); }
            50% { filter: brightness(1.3) saturate(1.5); }
        }

        /* Frame 3: Team Hero */
        .frame-team-hero {
            background: radial-gradient(circle at center, rgba(0, 212, 255, 0.2) 0%, transparent 70%);
            border: 8px solid var(--neon-blue);
            box-shadow: 0 0 60px rgba(0, 212, 255, 0.4);
            animation: heroGlow 2.5s ease-in-out infinite alternate;
        }

        .frame-team-hero::before {
            content: '⚡ Team Hero';
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            color: var(--neon-blue);
            font-size: 1.4rem;
            font-weight: bold;
            text-shadow: 0 0 20px rgba(0, 212, 255, 0.8);
        }

        @keyframes heroGlow {
            0% { box-shadow: 0 0 60px rgba(0, 212, 255, 0.4); }
            100% { box-shadow: 0 0 100px rgba(0, 212, 255, 0.7); }
        }

        /* Frame 4: Glitch Style */
        .frame-glitch {
            border: 8px solid var(--neon-pink);
            animation: glitchEffect 0.3s infinite;
        }

        .frame-glitch::before {
            content: '🔥 Glitch Style';
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            color: var(--neon-pink);
            font-size: 1.4rem;
            font-weight: bold;
            text-shadow: 0 0 20px rgba(255, 0, 128, 0.8);
            animation: textGlitch 0.5s infinite;
        }

        @keyframes glitchEffect {
            0%, 90%, 100% { 
                clip-path: inset(0);
                border-color: var(--neon-pink);
            }
            10% { 
                clip-path: inset(10px 0 85% 0);
                border-color: var(--neon-green);
            }
            20% { 
                clip-path: inset(80% 0 10% 0);
                border-color: var(--neon-blue);
            }
        }

        @keyframes textGlitch {
            0%, 90%, 100% { color: var(--neon-pink); }
            10% { color: var(--neon-green); }
            20% { color: var(--neon-blue); }
        }

        /* Frame 5: Cyber Neon */
        .frame-neon {
            border: 8px solid var(--neon-blue);
            box-shadow: 
                0 0 20px var(--neon-blue),
                inset 0 0 20px rgba(0, 212, 255, 0.1);
            animation: neonPulse 1s ease-in-out infinite alternate;
        }

        .frame-neon::before {
            content: '💎 Cyber Neon';
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            color: var(--neon-blue);
            font-size: 1.4rem;
            font-weight: bold;
            text-shadow: 0 0 20px rgba(0, 212, 255, 0.8);
        }

        @keyframes neonPulse {
            0% { 
                box-shadow: 0 0 20px var(--neon-blue), inset 0 0 20px rgba(0, 212, 255, 0.1);
                filter: blur(0px);
            }
            100% { 
                box-shadow: 0 0 40px var(--neon-blue), inset 0 0 40px rgba(0, 212, 255, 0.3);
                filter: blur(1px);
            }
        }

        @keyframes pulse {
            0% { 
                transform: scale(1);
                opacity: 1;
            }
            50% { 
                transform: scale(1.1);
                opacity: 0.8;
            }
            100% { 
                transform: scale(1);
                opacity: 1;
            }
        }

        /* Frame 6: Sponsor */
        .frame-sponsor {
            background: rgba(0, 0, 0, 0.8);
            border: 8px solid rgba(0, 212, 255, 0.6);
            box-shadow: 0 0 30px rgba(0, 212, 255, 0.2);
        }

        .frame-sponsor::before {
            content: 'Powered by Sponsors';
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            color: rgba(255, 255, 255, 0.8);
            font-size: 1.2rem;
            font-weight: normal;
        }

        .frame-sponsor::after {
            content: 'SPONSOR LOGO';
            position: absolute;
            bottom: 20px;
            right: 20px;
            width: 200px;
            height: 100px;
            background: linear-gradient(45deg, rgba(0, 212, 255, 0.2), rgba(123, 63, 228, 0.2));
            border: 1px solid rgba(0, 212, 255, 0.4);
            display: flex;
            align-items: center;
            justify-content: center;
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.9rem;
        }

        .controls {
            background: rgba(0, 0, 0, 0.8);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(123, 63, 228, 0.3);
            box-shadow: 0 0 30px rgba(123, 63, 228, 0.2);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: var(--neon-blue);
            font-weight: bold;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid rgba(123, 63, 228, 0.3);
            border-radius: 8px;
            background: rgba(0, 0, 0, 0.6);
            color: white;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: var(--neon-blue);
            box-shadow: 0 0 20px rgba(0, 212, 255, 0.3);
        }

        .btn {
            width: 100%;
            padding: 15px;
            margin-bottom: 10px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn-primary {
            background: linear-gradient(45deg, var(--primary-purple), var(--neon-blue));
            color: white;
            box-shadow: 0 0 20px rgba(123, 63, 228, 0.4);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 30px rgba(123, 63, 228, 0.6);
        }

        .btn-success {
            background: linear-gradient(45deg, var(--neon-green), #00cc66);
            color: white;
            box-shadow: 0 0 20px rgba(0, 255, 136, 0.4);
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 30px rgba(0, 255, 136, 0.6);
        }

        .btn-warning {
            background: linear-gradient(45deg, var(--gold), #ffaa00);
            color: black;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.4);
        }

        .btn-warning:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 30px rgba(255, 215, 0, 0.6);
        }

        .btn-info {
            background: linear-gradient(45deg, var(--neon-pink), #ff4081);
            color: white;
            box-shadow: 0 0 20px rgba(255, 0, 128, 0.4);
        }

        .btn-info:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 30px rgba(255, 0, 128, 0.6);
        }

        .frame-selector {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        .frame-btn {
            padding: 10px;
            border: 2px solid rgba(123, 63, 228, 0.3);
            border-radius: 8px;
            background: rgba(0, 0, 0, 0.6);
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            font-size: 0.9rem;
        }

        .frame-btn:hover, .frame-btn.active {
            border-color: var(--neon-blue);
            background: rgba(0, 212, 255, 0.1);
            box-shadow: 0 0 15px rgba(0, 212, 255, 0.3);
        }

        .preview-section {
            margin-top: 30px;
            text-align: center;
        }

        #preview {
            max-width: 100%;
            border-radius: 15px;
            box-shadow: 0 0 40px rgba(123, 63, 228, 0.4);
            margin-bottom: 20px;
        }

        .footer {
            text-align: center;
            padding: 30px 20px;
            border-top: 1px solid rgba(123, 63, 228, 0.3);
            background: rgba(0, 0, 0, 0.3);
            margin-top: 40px;
        }

        .footer p {
            color: #888;
            font-size: 0.9rem;
            line-height: 1.6;
        }

        .footer a {
            color: var(--neon-blue);
            text-decoration: none;
        }

        .footer a:hover {
            text-shadow: 0 0 10px rgba(0, 212, 255, 0.8);
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .frame-selector {
                grid-template-columns: 1fr;
            }
            
            .container {
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>RVC101 Esports Challenge 2025 — Photo Booth</h1>
            <p>ถ่ายรูปทีมคุณในกรอบกิจกรรม แชร์ความมันส์ รับของรางวัล!</p>
        </header>

        <div class="main-content">
            <div class="camera-section">
                <div class="camera-container">
                    <video id="video" autoplay muted playsinline style="display: none;"></video>
                    <div id="cameraPlaceholder" class="camera-placeholder">
                        <p>📷 กดปุ่ม "เปิดกล้อง" เพื่อเริ่มถ่ายภาพ</p>
                        <p>อนุญาตการเข้าถึงกล้องเพื่อใช้งาน Photo Booth</p>
                    </div>
                    
                    <!-- Frame 1: RVC101 Main -->
                    <div class="frame-overlay frame-rvc101-main" id="frame-rvc101-main"></div>
                    
                    <!-- Frame 2: Esports Champion -->
                    <div class="frame-overlay frame-esports-champ" id="frame-esports-champ"></div>
                    
                    <!-- Frame 3: Team Hero -->
                    <div class="frame-overlay frame-team-hero" id="frame-team-hero"></div>
                    
                    <!-- Frame 4: Glitch Style -->
                    <div class="frame-overlay frame-glitch" id="frame-glitch"></div>
                    
                    <!-- Frame 5: Cyber Neon -->
                    <div class="frame-overlay frame-neon" id="frame-neon"></div>
                    
                    <!-- Frame 6: Sponsor -->
                    <div class="frame-overlay frame-sponsor" id="frame-sponsor"></div>
                    
                    <!-- Custom Frame -->
                    <div class="frame-overlay frame-custom" id="frame-custom"></div>
                </div>
                
                <!-- Countdown Display (inside camera container) -->
                <div id="countdownDisplay" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); display: none; font-size: 4rem; font-weight: bold; color: #00d4ff; text-shadow: 0 0 30px rgba(0, 212, 255, 0.8); animation: pulse 1s infinite; z-index: 1000;">
                    <!-- Countdown numbers will appear here -->
                </div>
                
                <!-- Camera Control Buttons (moved below camera) -->
                <div style="text-align: center; margin-top: 20px;">
                    <div style="display: flex; gap: 15px; justify-content: center; align-items: center; flex-wrap: wrap;">
                        <button class="btn btn-success" id="capturePhoto" style="display: none; width: auto; padding: 15px 30px;">📸 ถ่ายภาพ</button>
                        <button class="btn btn-warning" id="timerCapture" style="display: none; width: auto; padding: 15px 30px;">⏰ ถ่ายด้วยจับเวลา (4วิ)</button>
                    </div>
                </div>
            </div>

            <div class="controls">
                <div class="form-group">
                    <label for="nickname">ชื่อเล่น (Nickname)</label>
                    <input type="text" id="nickname" placeholder="ใส่ชื่อเล่นของคุณ">
                </div>

                <div class="form-group">
                    <label for="teamName">ชื่อทีม (Team Name)</label>
                    <input type="text" id="teamName" placeholder="ใส่ชื่อทีมของคุณ">
                </div>

                <div class="form-group">
                    <label>เลือกกรอบกิจกรรม</label>
                    <div class="frame-selector">
                        <div class="frame-btn active" data-frame="frame-rvc101-main">RVC101 Main</div>
                        <div class="frame-btn" data-frame="frame-esports-champ">Champion</div>
                        <div class="frame-btn" data-frame="frame-team-hero">Team Hero</div>
                        <div class="frame-btn" data-frame="frame-glitch">Glitch Style</div>
                        <div class="frame-btn" data-frame="frame-neon">Cyber Neon</div>
                        <div class="frame-btn" data-frame="frame-sponsor">Sponsor</div>
                        <div class="frame-btn" data-frame="frame-custom" id="customFrameBtn" style="display: none;">Custom Frame</div>
                    </div>
                    
                    <!-- Custom Frame Selector (shown when custom frames are available) -->
                    <div id="customFrameSelector" style="display: none; margin-top: 15px;">
                        <label style="color: #00d4ff; font-weight: bold; margin-bottom: 10px; display: block;">เลือกเฟรมที่อัพโหลด</label>
                        <div id="customFrameList" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; max-height: 200px; overflow-y: auto;">
                            <!-- Custom frame thumbnails will be added here -->
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="customFrame">อัพโหลดเฟรมเอง (PNG/JPG) - สามารถเลือกหลายไฟล์</label>
                    <input type="file" id="customFrame" accept="image/*" multiple style="padding: 8px;">
                    <div style="margin-top: 8px; padding: 10px; background: rgba(0, 212, 255, 0.1); border-radius: 5px; font-size: 0.85rem; color: #00d4ff;">
                        <strong>📏 ขนาดเฟรมที่แนะนำ:</strong><br>
                        • <strong>HD:</strong> 1280 x 720 พิกเซล (16:9)<br>
                        • <strong>Full HD:</strong> 1920 x 1080 พิกเซล (16:9)<br>
                        • <strong>Square:</strong> 1080 x 1080 พิกเซล (1:1)<br>
                        • <strong>Portrait:</strong> 1080 x 1350 พิกเซล (4:5)<br><br>
                        <strong>💡 เคล็ดลับ:</strong> ใช้ไฟล์ PNG พื้นหลังโปร่งใส หรือ JPG คุณภาพสูง<br>
                        ขนาดไฟล์ไม่เกิน 5MB เพื่อประสิทธิภาพที่ดี
                    </div>
                </div>

                <button class="btn btn-primary" id="startCamera">📷 เปิดกล้อง</button>
            </div>
        </div>

        <div class="preview-section" id="previewSection" style="display: none;">
            <h3>ภาพที่ถ่าย</h3>
            <img id="preview" alt="ภาพที่ถ่าย">
            <div style="display: flex; gap: 15px; justify-content: center; margin-top: 20px; flex-wrap: wrap;">
                <button class="btn btn-success" id="retakePhoto" style="display: none; width: auto; padding: 12px 30px;">📷 ถ่ายใหม่</button>
                <button class="btn btn-warning" id="downloadPhoto" style="display: none; width: auto; padding: 12px 30px;">💾 ดาวน์โหลด PNG</button>
                <button class="btn btn-info" id="sharePhoto" style="display: none; width: auto; padding: 12px 30px;">📤 แชร์ภาพ</button>
            </div>
        </div>
    </div>

    <footer class="footer">
        <p>จัดทำโดย: ครูสุภาดา คำตา แผนกเทคโนโลยีสารสนเทศ วิทยาลัยอาชีวศึกษาร้อยเอ็ด</p>
        <p>ติดต่อ: <a href="mailto:suphada@rvc.ac.th">suphada@rvc.ac.th</a> | โทร <a href="tel:097-1697157">097-1697157</a></p>
    </footer>

    <canvas id="canvas" style="display: none;"></canvas>

    <script>
        let stream = null;
        let currentFrame = 'frame-rvc101-main';
        let customFrames = []; // Array to store multiple custom frames
        let selectedCustomFrameIndex = 0;
        
        const video = document.getElementById('video');
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const preview = document.getElementById('preview');
        const previewSection = document.getElementById('previewSection');
        const cameraPlaceholder = document.getElementById('cameraPlaceholder');
        
        const startCameraBtn = document.getElementById('startCamera');
        const capturePhotoBtn = document.getElementById('capturePhoto');
        const timerCaptureBtn = document.getElementById('timerCapture');
        const countdownDisplay = document.getElementById('countdownDisplay');
        const downloadPhotoBtn = document.getElementById('downloadPhoto');
        const sharePhotoBtn = document.getElementById('sharePhoto');
        const retakePhotoBtn = document.getElementById('retakePhoto');
        const customFrameInput = document.getElementById('customFrame');
        const customFrameBtn = document.getElementById('customFrameBtn');
        
        let countdownTimer = null;
        
        const nicknameInput = document.getElementById('nickname');
        const teamNameInput = document.getElementById('teamName');
        
        // Custom frame upload (multiple files)
        customFrameInput.addEventListener('change', function(e) {
            const files = Array.from(e.target.files);
            if (files.length > 0) {
                let loadedCount = 0;
                const totalFiles = files.length;
                
                files.forEach((file, index) => {
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        const img = new Image();
                        img.onload = function() {
                            // Add to custom frames array
                            customFrames.push({
                                image: img,
                                dataUrl: event.target.result,
                                name: file.name
                            });
                            
                            loadedCount++;
                            
                            // When all files are loaded
                            if (loadedCount === totalFiles) {
                                updateCustomFrameUI();
                                
                                // Auto-select custom frame and show the first one
                                selectedCustomFrameIndex = customFrames.length - totalFiles; // Start with first new frame
                                selectCustomFrame(selectedCustomFrameIndex);
                                
                                showCustomAlert(`อัพโหลดเฟรมสำเร็จ! เพิ่มเฟรมใหม่ ${totalFiles} ภาพ`);
                            }
                        };
                        img.src = event.target.result;
                    };
                    reader.readAsDataURL(file);
                });
            }
        });
        
        // Frame selection
        document.querySelectorAll('.frame-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                // Remove active class from all buttons
                document.querySelectorAll('.frame-btn').forEach(b => b.classList.remove('active'));
                // Add active class to clicked button
                this.classList.add('active');
                
                // Hide all frames
                document.querySelectorAll('.frame-overlay').forEach(frame => {
                    frame.classList.remove('active');
                });
                
                // Show selected frame
                currentFrame = this.dataset.frame;
                document.getElementById(currentFrame).classList.add('active');
            });
        });
        
        // Start camera
        startCameraBtn.addEventListener('click', async function() {
            try {
                stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { 
                        width: { ideal: 1280 },
                        height: { ideal: 720 }
                    } 
                });
                
                video.srcObject = stream;
                video.style.display = 'block';
                cameraPlaceholder.style.display = 'none';
                
                startCameraBtn.style.display = 'none';
                capturePhotoBtn.style.display = 'block';
                timerCaptureBtn.style.display = 'block';
                
                // Show default frame
                document.getElementById(currentFrame).classList.add('active');
                
            } catch (err) {
                cameraPlaceholder.innerHTML = `
                    <p>❌ ไม่สามารถเข้าถึงกล้องได้</p>
                    <p>กรุณาอนุญาตการเข้าถึงกล้องในเบราว์เซอร์</p>
                    <p>หรือตรวจสอบว่าเว็บไซต์ทำงานบน HTTPS</p>
                `;
            }
        });
        
        // Capture photo function
        function capturePhoto() {
            const nickname = nicknameInput.value.trim();
            const teamName = teamNameInput.value.trim();
            
            if (!nickname || !teamName) {
                // Create custom modal instead of alert
                showCustomAlert('กรุณาใส่ชื่อเล่นและชื่อทีมก่อนถ่ายภาพ');
                return;
            }
            
            // Set canvas size to match video
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            
            // Draw video frame
            ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
            
            // Draw frame overlay
            if (currentFrame === 'frame-custom' && customFrames.length > 0) {
                // Draw selected custom frame
                const selectedFrame = customFrames[selectedCustomFrameIndex];
                if (selectedFrame) {
                    ctx.drawImage(selectedFrame.image, 0, 0, canvas.width, canvas.height);
                }
            } else {
                drawFrameOverlay(ctx, canvas.width, canvas.height);
            }
            
            // Draw text overlay
            drawTextOverlay(ctx, nickname, teamName, canvas.width, canvas.height);
            
            // Convert to image and show preview
            const imageDataUrl = canvas.toDataURL('image/png');
            preview.src = imageDataUrl;
            previewSection.style.display = 'block';
            retakePhotoBtn.style.display = 'block';
            downloadPhotoBtn.style.display = 'block';
            sharePhotoBtn.style.display = 'block';
            
            // Hide capture buttons and show retake option
            capturePhotoBtn.style.display = 'none';
            timerCaptureBtn.style.display = 'none';
            
            // Scroll to preview
            previewSection.scrollIntoView({ behavior: 'smooth' });
        }
        
        // Capture photo button
        capturePhotoBtn.addEventListener('click', capturePhoto);
        
        // Timer capture button
        timerCaptureBtn.addEventListener('click', function() {
            const nickname = nicknameInput.value.trim();
            const teamName = teamNameInput.value.trim();
            
            if (!nickname || !teamName) {
                showCustomAlert('กรุณาใส่ชื่อเล่นและชื่อทีมก่อนถ่ายภาพ');
                return;
            }
            
            // Start countdown
            startCountdown();
        });
        
        // Countdown function
        function startCountdown() {
            let count = 4;
            countdownDisplay.style.display = 'block';
            countdownDisplay.textContent = count;
            
            // Disable buttons during countdown
            capturePhotoBtn.disabled = true;
            timerCaptureBtn.disabled = true;
            capturePhotoBtn.style.opacity = '0.5';
            timerCaptureBtn.style.opacity = '0.5';
            
            countdownTimer = setInterval(function() {
                count--;
                if (count > 0) {
                    countdownDisplay.textContent = count;
                } else {
                    // Take photo
                    countdownDisplay.textContent = '📸';
                    setTimeout(function() {
                        capturePhoto();
                        
                        // Hide countdown and re-enable buttons
                        countdownDisplay.style.display = 'none';
                        capturePhotoBtn.disabled = false;
                        timerCaptureBtn.disabled = false;
                        capturePhotoBtn.style.opacity = '1';
                        timerCaptureBtn.style.opacity = '1';
                        
                        clearInterval(countdownTimer);
                    }, 500);
                }
            }, 1000);
        }
        
        // Retake photo
        retakePhotoBtn.addEventListener('click', function() {
            // Clear any running countdown
            if (countdownTimer) {
                clearInterval(countdownTimer);
                countdownTimer = null;
            }
            
            // Hide preview section
            previewSection.style.display = 'none';
            retakePhotoBtn.style.display = 'none';
            downloadPhotoBtn.style.display = 'none';
            sharePhotoBtn.style.display = 'none';
            countdownDisplay.style.display = 'none';
            
            // Show capture buttons again
            capturePhotoBtn.style.display = 'block';
            timerCaptureBtn.style.display = 'block';
            
            // Re-enable buttons
            capturePhotoBtn.disabled = false;
            timerCaptureBtn.disabled = false;
            capturePhotoBtn.style.opacity = '1';
            timerCaptureBtn.style.opacity = '1';
            
            // Scroll back to camera
            document.querySelector('.camera-container').scrollIntoView({ behavior: 'smooth' });
        });
        
        // Download photo
        downloadPhotoBtn.addEventListener('click', function() {
            const link = document.createElement('a');
            link.download = `RVC101_${nicknameInput.value}_${teamNameInput.value}_${Date.now()}.png`;
            link.href = canvas.toDataURL('image/png');
            link.click();
        });
        
        // Share photo
        sharePhotoBtn.addEventListener('click', async function() {
            try {
                // Convert canvas to blob
                canvas.toBlob(async function(blob) {
                    const fileName = `RVC101_${nicknameInput.value}_${teamNameInput.value}_${Date.now()}.png`;
                    
                    // Check if Web Share API is supported
                    if (navigator.share && navigator.canShare) {
                        const file = new File([blob], fileName, { type: 'image/png' });
                        
                        if (navigator.canShare({ files: [file] })) {
                            try {
                                await navigator.share({
                                    title: 'RVC101 Esports Challenge 2025',
                                    text: `ภาพจาก RVC101 Esports Challenge 2025 - ${nicknameInput.value} (${teamNameInput.value})`,
                                    files: [file]
                                });
                                showCustomAlert('แชร์ภาพสำเร็จ!');
                            } catch (err) {
                                if (err.name !== 'AbortError') {
                                    fallbackShare(blob, fileName);
                                }
                            }
                        } else {
                            fallbackShare(blob, fileName);
                        }
                    } else {
                        fallbackShare(blob, fileName);
                    }
                }, 'image/png');
            } catch (err) {
                showCustomAlert('เกิดข้อผิดพลาดในการแชร์ภาพ');
            }
        });
        
        function fallbackShare(blob, fileName) {
            // Create a temporary URL for the image
            const url = URL.createObjectURL(blob);
            
            // Create share modal
            const shareModal = document.createElement('div');
            shareModal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.9);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
            `;
            
            const shareContent = document.createElement('div');
            shareContent.style.cssText = `
                background: linear-gradient(135deg, #1a1a2e, #16213e);
                border: 2px solid #7b3fe4;
                border-radius: 15px;
                padding: 30px;
                max-width: 500px;
                text-align: center;
                box-shadow: 0 0 50px rgba(123, 63, 228, 0.5);
            `;
            
            shareContent.innerHTML = `
                <h3 style="color: #00d4ff; margin-bottom: 20px;">แชร์ภาพของคุณ</h3>
                <img src="${url}" style="max-width: 300px; max-height: 200px; border-radius: 10px; margin-bottom: 20px;">
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-bottom: 20px;">
                    <button id="copyLink" style="
                        background: linear-gradient(45deg, #7b3fe4, #00d4ff);
                        color: white;
                        border: none;
                        padding: 12px;
                        border-radius: 8px;
                        cursor: pointer;
                        font-weight: bold;
                    ">📋 คัดลอกลิงก์</button>
                    <button id="downloadShare" style="
                        background: linear-gradient(45deg, #ffd700, #ffaa00);
                        color: black;
                        border: none;
                        padding: 12px;
                        border-radius: 8px;
                        cursor: pointer;
                        font-weight: bold;
                    ">💾 ดาวน์โหลด</button>
                    <button id="shareWhatsApp" style="
                        background: linear-gradient(45deg, #25d366, #128c7e);
                        color: white;
                        border: none;
                        padding: 12px;
                        border-radius: 8px;
                        cursor: pointer;
                        font-weight: bold;
                    ">📱 WhatsApp</button>
                    <button id="shareFacebook" style="
                        background: linear-gradient(45deg, #1877f2, #42a5f5);
                        color: white;
                        border: none;
                        padding: 12px;
                        border-radius: 8px;
                        cursor: pointer;
                        font-weight: bold;
                    ">📘 Facebook</button>
                </div>
                <button id="closeShare" style="
                    background: linear-gradient(45deg, #ff0080, #ff4081);
                    color: white;
                    border: none;
                    padding: 12px 30px;
                    border-radius: 8px;
                    cursor: pointer;
                    font-weight: bold;
                ">ปิด</button>
            `;
            
            shareModal.appendChild(shareContent);
            document.body.appendChild(shareModal);
            
            // Event listeners for share options
            document.getElementById('copyLink').addEventListener('click', async function() {
                try {
                    await navigator.clipboard.writeText(url);
                    this.textContent = '✅ คัดลอกแล้ว!';
                    setTimeout(() => {
                        this.textContent = '📋 คัดลอกลิงก์';
                    }, 2000);
                } catch (err) {
                    showCustomAlert('ไม่สามารถคัดลอกลิงก์ได้');
                }
            });
            
            document.getElementById('downloadShare').addEventListener('click', function() {
                const link = document.createElement('a');
                link.download = fileName;
                link.href = url;
                link.click();
            });
            
            document.getElementById('shareWhatsApp').addEventListener('click', function() {
                const text = encodeURIComponent(`ภาพจาก RVC101 Esports Challenge 2025 - ${nicknameInput.value} (${teamNameInput.value})`);
                window.open(`https://wa.me/?text=${text}`, '_blank', 'noopener,noreferrer');
            });
            
            document.getElementById('shareFacebook').addEventListener('click', function() {
                const text = encodeURIComponent(`ภาพจาก RVC101 Esports Challenge 2025 - ${nicknameInput.value} (${teamNameInput.value})`);
                window.open(`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(window.location.href)}&quote=${text}`, '_blank', 'noopener,noreferrer');
            });
            
            document.getElementById('closeShare').addEventListener('click', function() {
                URL.revokeObjectURL(url);
                document.body.removeChild(shareModal);
            });
            
            // Close on backdrop click
            shareModal.addEventListener('click', function(e) {
                if (e.target === shareModal) {
                    URL.revokeObjectURL(url);
                    document.body.removeChild(shareModal);
                }
            });
        }
        
        function drawFrameOverlay(ctx, width, height) {
            const frameData = getFrameData(currentFrame);
            
            // Save context
            ctx.save();
            
            // Draw frame border
            ctx.strokeStyle = frameData.borderColor;
            ctx.lineWidth = 12;
            ctx.strokeRect(10, 10, width - 20, height - 20);
            
            // Draw frame effects
            if (frameData.effects) {
                frameData.effects.forEach(effect => {
                    effect(ctx, width, height);
                });
            }
            
            // Draw frame title
            if (frameData.title) {
                ctx.fillStyle = frameData.titleColor;
                ctx.font = 'bold 28px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(frameData.title, width / 2, 60);
            }
            
            // Restore context
            ctx.restore();
        }
        
        function drawTextOverlay(ctx, nickname, teamName, width, height) {
            ctx.save();
            
            // Draw semi-transparent background for text
            ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
            ctx.fillRect(0, height - 120, width, 120);
            
            // Draw nickname
            ctx.fillStyle = '#00d4ff';
            ctx.font = 'bold 32px Arial';
            ctx.textAlign = 'left';
            ctx.fillText(`🎮 ${nickname}`, 30, height - 70);
            
            // Draw team name
            ctx.fillStyle = '#7b3fe4';
            ctx.font = 'bold 28px Arial';
            ctx.fillText(`🏆 ${teamName}`, 30, height - 30);
            
            // Draw timestamp
            ctx.fillStyle = '#ffffff';
            ctx.font = '20px Arial';
            ctx.textAlign = 'right';
            const now = new Date();
            const timestamp = now.toLocaleDateString('th-TH') + ' ' + now.toLocaleTimeString('th-TH');
            ctx.fillText(timestamp, width - 30, height - 30);
            
            ctx.restore();
        }
        
        function getFrameData(frameId) {
            const frames = {
                'frame-rvc101-main': {
                    borderColor: '#7b3fe4',
                    title: 'RVC101 Esports Challenge 2025',
                    titleColor: '#7b3fe4',
                    effects: [
                        (ctx, w, h) => {
                            // Circuit-like corners
                            ctx.strokeStyle = '#00d4ff';
                            ctx.lineWidth = 3;
                            // Top-left corner
                            ctx.beginPath();
                            ctx.moveTo(50, 50);
                            ctx.lineTo(100, 50);
                            ctx.lineTo(100, 100);
                            ctx.stroke();
                            // Top-right corner
                            ctx.beginPath();
                            ctx.moveTo(w - 50, 50);
                            ctx.lineTo(w - 100, 50);
                            ctx.lineTo(w - 100, 100);
                            ctx.stroke();
                            // Bottom-left corner
                            ctx.beginPath();
                            ctx.moveTo(50, h - 50);
                            ctx.lineTo(100, h - 50);
                            ctx.lineTo(100, h - 100);
                            ctx.stroke();
                            // Bottom-right corner
                            ctx.beginPath();
                            ctx.moveTo(w - 50, h - 50);
                            ctx.lineTo(w - 100, h - 50);
                            ctx.lineTo(w - 100, h - 100);
                            ctx.stroke();
                        }
                    ]
                },
                'frame-esports-champ': {
                    borderColor: '#ffd700',
                    title: '👑 Champion Mode',
                    titleColor: '#ffd700',
                    effects: [
                        (ctx, w, h) => {
                            // Golden gradient border
                            const gradient = ctx.createLinearGradient(0, 0, w, h);
                            gradient.addColorStop(0, '#ffd700');
                            gradient.addColorStop(0.5, '#b87333');
                            gradient.addColorStop(1, '#ffd700');
                            ctx.strokeStyle = gradient;
                            ctx.lineWidth = 12;
                            ctx.strokeRect(5, 5, w - 10, h - 10);
                        }
                    ]
                },
                'frame-team-hero': {
                    borderColor: '#00d4ff',
                    title: '⚡ Team Hero',
                    titleColor: '#00d4ff',
                    effects: [
                        (ctx, w, h) => {
                            // Radial glow effect
                            const gradient = ctx.createRadialGradient(w/2, h/2, 0, w/2, h/2, Math.max(w, h)/2);
                            gradient.addColorStop(0, 'rgba(0, 212, 255, 0.3)');
                            gradient.addColorStop(1, 'transparent');
                            ctx.fillStyle = gradient;
                            ctx.fillRect(0, 0, w, h);
                        }
                    ]
                },
                'frame-glitch': {
                    borderColor: '#ff0080',
                    title: '🔥 Glitch Style',
                    titleColor: '#ff0080',
                    effects: [
                        (ctx, w, h) => {
                            // Glitch lines
                            ctx.strokeStyle = '#00ff88';
                            ctx.lineWidth = 2;
                            for (let i = 0; i < 5; i++) {
                                const y = Math.random() * h;
                                ctx.beginPath();
                                ctx.moveTo(0, y);
                                ctx.lineTo(w, y);
                                ctx.stroke();
                            }
                        }
                    ]
                },
                'frame-neon': {
                    borderColor: '#00d4ff',
                    title: '💎 Cyber Neon',
                    titleColor: '#00d4ff',
                    effects: [
                        (ctx, w, h) => {
                            // Neon glow border
                            ctx.shadowColor = '#00d4ff';
                            ctx.shadowBlur = 20;
                            ctx.strokeStyle = '#00d4ff';
                            ctx.lineWidth = 8;
                            ctx.strokeRect(15, 15, w - 30, h - 30);
                            ctx.shadowBlur = 0;
                        }
                    ]
                },
                'frame-sponsor': {
                    borderColor: 'rgba(0, 212, 255, 0.6)',
                    title: 'Powered by Sponsors',
                    titleColor: 'rgba(255, 255, 255, 0.8)',
                    effects: [
                        (ctx, w, h) => {
                            // Sponsor logo area
                            ctx.fillStyle = 'rgba(0, 212, 255, 0.2)';
                            ctx.fillRect(w - 220, h - 120, 200, 100);
                            ctx.strokeStyle = 'rgba(0, 212, 255, 0.4)';
                            ctx.lineWidth = 4;
                            ctx.strokeRect(w - 220, h - 120, 200, 100);
                            
                            // Sponsor text
                            ctx.fillStyle = 'rgba(255, 255, 255, 0.6)';
                            ctx.font = '16px Arial';
                            ctx.textAlign = 'center';
                            ctx.fillText('SPONSOR LOGO', w - 120, h - 65);
                        }
                    ]
                }
            };
            
            return frames[frameId] || frames['frame-rvc101-main'];
        }
        
        // Function to update custom frame UI
        function updateCustomFrameUI() {
            const customFrameSelector = document.getElementById('customFrameSelector');
            const customFrameList = document.getElementById('customFrameList');
            const customFrameBtn = document.getElementById('customFrameBtn');
            
            if (customFrames.length > 0) {
                customFrameBtn.style.display = 'block';
                customFrameSelector.style.display = 'block';
                
                // Clear existing thumbnails
                customFrameList.innerHTML = '';
                
                // Add thumbnails for each custom frame
                customFrames.forEach((frame, index) => {
                    const thumbnail = document.createElement('div');
                    thumbnail.style.cssText = `
                        width: 80px;
                        height: 60px;
                        background-image: url(${frame.dataUrl});
                        background-size: cover;
                        background-position: center;
                        border: 2px solid ${index === selectedCustomFrameIndex ? '#00d4ff' : 'rgba(123, 63, 228, 0.3)'};
                        border-radius: 5px;
                        cursor: pointer;
                        transition: all 0.3s ease;
                        position: relative;
                        overflow: hidden;
                    `;
                    
                    // Add frame number
                    const frameNumber = document.createElement('div');
                    frameNumber.textContent = index + 1;
                    frameNumber.style.cssText = `
                        position: absolute;
                        top: 2px;
                        right: 2px;
                        background: rgba(0, 0, 0, 0.7);
                        color: white;
                        font-size: 10px;
                        padding: 2px 4px;
                        border-radius: 3px;
                        font-weight: bold;
                    `;
                    
                    thumbnail.appendChild(frameNumber);
                    
                    // Add click event
                    thumbnail.addEventListener('click', function() {
                        selectCustomFrame(index);
                    });
                    
                    // Add hover effect
                    thumbnail.addEventListener('mouseenter', function() {
                        if (index !== selectedCustomFrameIndex) {
                            this.style.borderColor = '#7b3fe4';
                            this.style.boxShadow = '0 0 10px rgba(123, 63, 228, 0.5)';
                        }
                    });
                    
                    thumbnail.addEventListener('mouseleave', function() {
                        if (index !== selectedCustomFrameIndex) {
                            this.style.borderColor = 'rgba(123, 63, 228, 0.3)';
                            this.style.boxShadow = 'none';
                        }
                    });
                    
                    customFrameList.appendChild(thumbnail);
                });
            }
        }
        
        // Function to select a custom frame
        function selectCustomFrame(index) {
            if (index >= 0 && index < customFrames.length) {
                selectedCustomFrameIndex = index;
                
                // Update UI
                updateCustomFrameUI();
                
                // Auto-select custom frame category
                document.querySelectorAll('.frame-btn').forEach(b => b.classList.remove('active'));
                document.getElementById('customFrameBtn').classList.add('active');
                
                // Hide all frames and show custom
                document.querySelectorAll('.frame-overlay').forEach(frame => {
                    frame.classList.remove('active');
                });
                currentFrame = 'frame-custom';
                document.getElementById(currentFrame).classList.add('active');
                
                // Update custom frame background
                const customFrameElement = document.getElementById('frame-custom');
                const selectedFrame = customFrames[selectedCustomFrameIndex];
                customFrameElement.style.backgroundImage = `url(${selectedFrame.dataUrl})`;
                customFrameElement.style.backgroundSize = 'cover';
                customFrameElement.style.backgroundPosition = 'center';
                customFrameElement.style.backgroundRepeat = 'no-repeat';
            }
        }
        
        function showCustomAlert(message) {
            // Create custom alert modal
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.8);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
            `;
            
            const alertBox = document.createElement('div');
            alertBox.style.cssText = `
                background: linear-gradient(135deg, #1a1a2e, #16213e);
                border: 2px solid #7b3fe4;
                border-radius: 15px;
                padding: 30px;
                max-width: 400px;
                text-align: center;
                box-shadow: 0 0 50px rgba(123, 63, 228, 0.5);
            `;
            
            alertBox.innerHTML = `
                <p style="color: white; font-size: 1.1rem; margin-bottom: 20px;">${message}</p>
                <button id="alertOk" style="
                    background: linear-gradient(45deg, #7b3fe4, #00d4ff);
                    color: white;
                    border: none;
                    padding: 12px 30px;
                    border-radius: 8px;
                    font-size: 1rem;
                    font-weight: bold;
                    cursor: pointer;
                    box-shadow: 0 0 20px rgba(123, 63, 228, 0.4);
                ">ตกลง</button>
            `;
            
            modal.appendChild(alertBox);
            document.body.appendChild(modal);
            
            document.getElementById('alertOk').addEventListener('click', function() {
                document.body.removeChild(modal);
            });
            
            // Close on backdrop click
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    document.body.removeChild(modal);
                }
            });
        }
        
        // Initialize default frame
        document.getElementById(currentFrame).classList.add('active');
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9935dceb6202893f',t:'MTc2MTI3MTA0Mi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
